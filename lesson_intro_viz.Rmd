---
title: "Introduction to Visualization"
author: "Matt Williamson"
date: "2/1/2020"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidycensus)
library(tidyverse)
library(sf)
library(raster)
library(tmap)
library(rasterVis)
library(latticeExtra)
library(RColorBrewer)
library(viridis)
```

## Today's objectives
- Explore plotting vector data using `plot`, `spplot`, and `ggplot2`
- Explore plotting raster data using `plot`, `rasterViz`
- Map multiple layers using `spplot`, `ggplot2`, and `tmap`

## Visualization and spatial data


## Building a vector dataset
```{r}
census_api_key("90b94953d2f24e81e890229e0128174f5ba80d3f")

id.income <- get_acs(geography = "county", 
              variables = c("B19013_001", "B01002_001"),
              state = "ID", 
              year = 2018, geometry = TRUE) %>% #download censu data
  mutate(rename = str_replace_all(.$variable,(c("B19013_001"="income", "B01002_001"="age" )))) %>% 
  dplyr::select(c(GEOID, rename, estimate)) %>% #select the columns to keep
  spread(., key = rename, value = estimate) #have to use spread because pivot_wider not currently working for sf objects

#join our nonprofit data set
id.nonprof <- read.csv("./data/bmfcount.csv", stringsAsFactors = FALSE, colClasses = "character")

id.census.sf <- id.income %>% 
  left_join(., id.nonprof, by = c("GEOID" = "FIPS"))

id.census.sp <- as(id.census.sf, "Spatial")
```


## Plotting spatial data in base `plot`

- Base `plot` handles `Spatial*` and `sf` objects differently
- Base `plot` is useful for quick exploration of data and figure drafting

```{r vectorplot, echo = TRUE}
plot(id.census.sp, main = "Idaho Counties", sub="2018 Census Data", col="blue", border="white")
plot(id.census.sf, main= "Idaho Counties", sub="2018 Census Data", col="blue", border="white")
#if you just want the sf geometry
plot(st_geometry(id.census.sf), col="blue", border="white")

#hard to plot by attributes in base plot with Spatial* objects
plot(id.census.sp$income)
#Easier with sf
plot(id.census.sf["income"], main= "Idaho Income", sub="Median county value as of 2018")

```

## Plotting raster data in baseplot
```{r rasterplot}
id.elev <- raster("data/id_elev.tif")
#create a reaster brick
id.terrain <- terrain(id.elev, opt=c('slope', 'TRI', 'TPI'))
plot(id.terrain)
```

## Adding functionality with `spplot`
- `spplot` follows the `lattice` approach for creating graphics
- Allows functionality for `Spatial*` objects similar to those for `sf` in base `plot`
- add layers using `list` and `sp.layout`
```{r}
#set up a color palette
income.pal <- brewer.pal(n = 7, name = "Greens")
spplot(id.census.sp, col.regions = income.pal, cuts = 6)

#plot a single variable
spplot(id.census.sp, 'income', col.regions = income.pal, cuts = 6)
spplot(id.census.sp, 'age', col.regions = brewer.pal(n = 7, name = "Blues"), cuts = 6)

spplot(id.terrain)
```
## Additional references
[Data Visualization: A Practical Introduction by Kieran Healy](https://socviz.co)

[The tmap package](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html)

[Plotting Simple Features](https://r-spatial.github.io/sf/articles/sf5.html)
