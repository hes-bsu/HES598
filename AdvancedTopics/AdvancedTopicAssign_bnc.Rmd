---
title: "Advanced Topic Instructions: Connectivity"
author: "Brent Clark"
date: "05/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


SAVE YOUR FILE IN THE AdvancedTopics FOLDER IN THE GIT REPO

## Introduce your problem

Give a brief introduction to your research and identify how your "Advanced Topic" plays into what you are hoping to do. For example, if you are just starting out on your project and your topic is "Study Design" you might be interested in developing a spatially informed sampling/stratification scheme.Or maybe your work is going to have a big public outreach component that you'd like to support with some nice interactive maps. Give us a sense for what "success" would look like - what is your ideal end product for the analysis/approach you're testing out. This will help us figure out if the tools you tried were successful.

# Research introduction and areas of interest
My research will use a variety of pedigree analyses to help understand population dynamics in a burrowing owl population that has been monitored for approximately 20 years. Thus, my research will combine field work during the next couple of breeding seasons with analysis of a long-term dataset to understand aspects of kin structuring and reproductive success in the population.  

I am interested in how kin relationships are structured spatially and temporally in a populationm quantifying lifetime reproductve success and examining if and how production of offspring and recruitement may differ by landcover type, and what are the patterns in burrow occupancy as it relates to nestlings produced and recruitement.  

# Problem to be solved
How is recruitement in a semi-colonial raptor species impacted by demographic connectivity?  Understanding the immigration and emmigration within a burrowing owl population can help determine low/high recruitment rates.  It can also help us understand how demographic connectivity of a population increases/decreases colonization of previously occupied/unoccupied burrows. 

## PSUEDOCODE!!
Before you get started programming all of the potential things you could do during the course of this demo. Lay out the steps you'll need to get there (see below for what I mean). You don't have to actually code these things (yet) just help us see how you're approaching the problem.

```{r install and load packages, include = FALSE}
#load the libraries 
install.packages("samc")
install.packages("gdistance")
install.packages("googledrive")
install.packages("here")
library(here)
library(googledrive)
library(tidyverse)
library(sp)
library(ggplot2)
library(sf)
library(rgdal)
library(raster)
library(readxl)

#Analysis/processing step 1 - what are you hoping to do here, why? 

#attempting to create a heat map of nestingls per nest site to help understand what nest sites have produced the most nestlings for the last 20+ years

#Analysis/processing step 2 - what are you hoping to do here, why? 

#Connectivity (still working out how best to do this step)

#Check the outcomes? How will you know if your steps worked?

# 
```

```{r loadData_Google Drive, include = FALSE}

#Provide link to data folder on google drive - folder "Brent"
folder_url <- "https://drive.google.com/open?id=1Mb8LbjqOGrGoWtbD1PXew0698boBJtH0" 

folder <- drive_get(as_id(folder_url))

gdrive_files <- drive_ls(folder)

lapply(gdrive_files$id, function(x) drive_download(as_id(x), path = paste0(here::here("datatemp/original/"), gdrive_files[gdrive_files$id==x,]$name), overwrite = TRUE))

file.list <- list.files(pattern = "*.tif, *.shp, *.csv, *.xlsx") #replace the pattern with the appropriate extensions for the files you want to load (e.g., .shp, .csv)


```

Introduce the study area (State of Idaho)
```{r bnc_studyAreaState,include = TRUE}
###
#Create the state of Idaho and elevation Map
###

#Get the Global Administration boundries with state lines of the United States
USA_0 <- getData(name = 'GADM', country = 'USA', level = 1)
#plot(USA_0)

#create the state of Idaho
idaho <- c("Idaho")

#extract the state of idaho from the GADM
ID = USA_0[match(toupper(idaho),toupper(USA_0$NAME_1)),]
#plot(ID)

#crop the GADM of US to only indclude the state of idaho
idaho_0 <- crop(USA_0, ID)
#plot(idaho_0)

#Get the SRTM with 90m resolution elevation data of the area around Idaho using longitude and latitude
elevID_1 <- getData("SRTM", lon = -115, lat = 44)
elevID_2 <- getData('SRTM', lon = -117, lat = 46)
elevID_3 <- getData("SRTM", lon = -118, lat = 43)
elevID_4 <- getData("SRTM", lon = -113, lat = 47)

#mosaic the SRTM's so that all of Idaho is covered and the boundries of Idaho is shown
elevID_mosaic <- mosaic(elevID_1, elevID_2, elevID_3, elevID_4, fun = mean)
#plot(elevID_mosaic)
#plot(idaho_0, add = TRUE)

#crop the mosaic of SRTM data with the boundry polygon of Idaho and plot new map
elevIdaho <- crop(elevID_mosaic, idaho_0)

###add counties where 'ABS' burrows are located
#read in idaho counties shape file
idaho_counties <- readOGR("~/library/Mobile Documents/com~apple~CloudDocs/BSU/Graduate - MS Raptor biology/r_Projects/HES598/datatemp/original/idaho_cty.shp")

#create separate map of Ada & Elmore counties
counties_AE <- subset(idaho_counties, NAME == "Ada" | NAME == "Elmore") #creates seperate map of just "Ada" and "Elmore" counties

#plot map with elevations, Idaho, and counties of interest
plot(elevIdaho, main = "Idaho Elevation (SRTM 90m Res)", xlab = "Longitude", ylab = "Latitude", legend.args = list(text = 'Elevation (m)', side = 4, line = 3, font = 2))
plot(idaho_0, add = TRUE)
plot(counties_AE, add = TRUE)
```

Introduce study area at the county level (Ada & Elmore Counties)
```{r studyAreaCounty}
###
#create an elvation map of Ada & Elmore counties 
###

#crop Idaho raster with county pologons to create only counties raster
elevCounties <- crop(elevIdaho, counties_AE)

#plot map of Ada & Elmore counties and elevations
plot(elevCounties, main = "Ada & Elmore County Elevation (SRTM 90m Res)", xlab = "Longitude", ylab = "Latitude", legend.args = list(text = 'Elevation (m)', side = 4, line = 3, font = 2))
plot(counties_AE, add = TRUE)

```


Create each of the artificial locations
```{r burrowLocals, include = TRUE}
###
#create the artificial burrows as a spatial object
###

#read excel data on artificial burrow locations (Lat & Long) into new data_frame
artBurrow_latlong <- read_excel("~/library/Mobile Documents/com~apple~CloudDocs/BSU/Graduate - MS Raptor biology/r_Projects/HES598/datatemp/original/Belthoff Burrows - latlong_revised.xlsx")

#from artificial burrow locaiton data_frame create spatial table 
#artBurrow_spatialTable <- artBurrow_utm %>% st_as_sf(coords = c("EASTING", "NORTHING"), crs = 4326)
artBurrow_spatialTable <- artBurrow_latlong %>% st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)

#creates burrow location points based on 'artBurrow_spatialTable'
artBurrow <- st_geometry(artBurrow_spatialTable) 
artBurrow <- st_set_crs(artBurrow, 4326)
plot(artBurrow, cex = 1.5, col = "black")

```

Overlay the artificial burrow locations onto study area
```{r burrowMap, include = TRUE}
###
#Overlay 'ABS' locations onto Ada & Elmore county Elevation map ('elevCounties')
###

#plot map of Ada & Elmore counties and elevations with 'ABS' locals
plot(elevCounties, main = "'ABS' locations - Ada & Elmore County Elevation (SRTM 90m Res)", xlab = "Longitude", ylab = "Latitude", legend.args = list(text = 'Elevation (m)', side = 4, line = 3, font = 2))
plot(counties_AE, add = TRUE)
plot(artBurrow, cex = 0.8, col = "black", add = TRUE)
```

## Introduce the packages
Given your psuedo code, where is the critical step? What packages and functions are you considering to help you complete this step? Why did you choose them? 

# R packages to try
"sf" - map creation
"raster" - map creation
"rgdal" - 
"samc" - provides long and short-term predictions of landscape connectivity measurements
"popbio" - would be used to determine population and demographic metrics

## Evaluate your choices
Use profiling and benchmarking to evaluate which of your options is likely to be the fastest. How does the syntax and/or ease of use of that function impact your decision of whether or not to use it? (For example, velox is much faster than raster, but it's less well documented and the syntax is strange to get used to).

## Show us your final product
Did you make a map? Let's see it. Did you plot some data that you extracted with raster? show us that plot. Did you have an idea of how the data should look after you were done processing it? Were you successful? What went wrong

## Reflect
Write a few sentences on what you learned from this exercise. How has your skill improved? What do you wish you understood better? What do you imagine your next steps to be?

Once you're done push the "knit" button to create the html page from your Rmarkdown document. If you've got questions, let me know!!