---
title: "Advanced Topic Assignment"
author: "Clara Buchholtz"
date: "3/29/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


SAVE YOUR FILE IN THE AdvancedTopics FOLDER IN THE GIT REPO

## Introduce your problem

Advanced topics focus: Spatial Stats, Point Patterns, Nearest Neighbors

My current research is focused on recreation disturbance patterns, and the greater ecological implications they can have for an ecosystem. I am working with the BLM Bruneau Field office to map baseline disturbance levels near subpopulations of Mulford's Milkvetch, a special status plant and a conservation priority for the region. These sites are ideal for study because the subpopulations have been monitored for decades, and long term data on their status, as well as nearby plant, human, and animal disturbances exist.  

The goal of my collaboration with the BLM will be to produce actionable products, such as maps and datasets that can inform management decisions. One of the ways a point pattern analysis could be used to this end would be to identify clusters of disturbance points, and use this to examine if something can explain why such a clustering might exist. 

Because I don't have point data yet, I will use this project to develop code that can test my future data. For this project I will use stand-in data that I've made in Google Earth, and converted to a shapefile. The shapefile is of points along official roads and trails where an unofficial trail starts, and represents an area within 0.25mi^2 distance of one of the subpopulations. This is the kind of point data I hope to have in the future, and I'll explore what it might look like here. I will also use this as an opportunity to practice simulating spatial data, and will explore the tests I run on simulated data as well. 


## PSUEDOCODE!!
Before you get started programming all of the potential things you could do during the course of this demo. Lay out the steps you'll need to get there (see below for what I mean). You don't have to actually code these things (yet) just help us see how you're approaching the problem.
```{r}
#load the libraries - tell us which packages you're using and why

#load your data - which datasets do you need?
#I'll be working with simulated point data to demonstrate some point pattern analyses. In order
#to do this, I'll create a plot with points within it, and then use spatial tests to investigate point patterns. Finally, I'll bring in real data and use the tests on the real data as well. 

#Making uniform density patterns:

#Starting with doing it in a rectangle.
# The number of points to create
n <- 300

# Set the range
xmin <- 0
xmax <- 1
ymin <- 0
ymax <- 2

# Sample from a Uniform distribution
x <- runif(n, xmin, xmax)
y <- runif(n, ymin, ymax )


# Plot points and a rectangle
# The aspect ratio of the boundary rectangle is 2 
# (it is twice as tall as wide), but the aspect ratio of the
# coordinates needs to be 1 so the rectangle appears that way.


# Plot points and a rectangle

mapxy <- function(a = NA){
  plot(x, y, asp = a)
  rect(xmin, ymin, xmax, ymax)
}

mapxy(1)

#-----generating x number of random points in a circle-------#
#plot circle with random points in it
# Load the spatstat package
library(spatstat)

# Create this many points, in a circle of this radius
n_points <- 300
radius <- 10

# Generate uniform random numbers up to radius-squared
r_squared <- runif(n_points, 0, radius^2)
angle <- runif(n_points, 0, 2*pi)

# Take the square root of the values to get a uniform spatial distribution
xx <- sqrt(r_squared)* cos(angle)
yy <- sqrt(r_squared) * sin(angle)

plot(disc(radius)); points(xx, yy)

#Organize the data - what form should the data be in? A list? how many elements, a data frame? how many rows and columns?

####I'll list simulated data in different forms here, and then demonstrate a test :
#random 
#clustered 
#inhibitory/regular

#Analysis/processing step 1 - what are you hoping to do here, why? 

#I'm going to do a basic test for uniformity of points. This is a simple point pattern analysis to try, and a good thing to screen point data for. 

#Testing for uniformity of points in a circle
# Define variables
#variables here are sourced from the sphere above, but needed for this analysis are:
#x - the, x coordinate
#y, the y coordinate
#window, the planar extent

# Set coordinates and window
ppxy <- ppp(x = xx, y = yy, window = disc(radius))

# Test the point pattern
qt <- quadrat.test(ppxy)

# View the results
plot(qt)
print(qt)

### Simulating clustered and regular point distributions
### Will use a function for a Thomas process for the clustered points, and a function for a 
### Straus process for the regular distribution

# Create a disc of radius 10, for the window space
disc10 <- disc(10)

# Generate clustered points from a Thomas process
set.seed(123)
p_cluster <- rThomas(kappa = 0.35, scale = 1, mu = 3, win = disc10)
plot(p_cluster)

# Run a quadrat test -- and this time test against an alt. hypothesis that the points are
#clustered
quadrat.test(p_cluster, alternative = "clustered")

# Regular points from a Strauss process
set.seed(123)
p_regular <- rStrauss(beta = 2.9, gamma = 0.025, R = .5, W = disc10)
plot(p_regular)

# Run a quadrat test, and in this case set the alternative hypothesis to specifically be 
#that the points are regularly distributed
quadrat.test(p_regular, alternative = "regular")

#Analysis/processing step 2 - what are you hoping to do here, why? 

#Check the outcomes? How will you know if your steps worked?

# 
```

## Introduce the packages
Given your psuedo code, where is the critical step? What packages and functions are you considering to help you complete this step? Why did you choose them? 

## Evaluate your choices
Use profiling and benchmarking to evaluate which of your options is likely to be the fastest. How does the syntax and/or ease of use of that function impact your decision of whether or not to use it? (For example, velox is much faster than raster, but it's less well documented and the syntax is strange to get used to).

## Show us your final product
Did you make a map? Let's see it. Did you plot some data that you extracted with raster? show us that plot. Did you have an idea of how the data should look after you were done processing it? Were you successful? What went wrong

## Reflect
Write a few sentences on what you learned from this exercise. How has your skill improved? What do you wish you understood better? What do you imagine your next steps to be?

Once you're done push the "knit" button to create the html page from your Rmarkdown document. If you've got questions, let me know!!