---
title: "Advanced Topic Instructions"
author: "Sandra Velazco"
date: "4/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


SAVE YOUR FILE IN THE AdvancedTopics FOLDER IN THE GIT REPO

## Introduce your problem

In the tropical Andes, bracken fern due to its vigor and rapid colonization inhibits the establishment of the native plants, delaying the recovery of the montane forest. My study investigate whether the distance and shape of Bracken fern-dominated patches from the forest affect natural regeneration in these patches in the north of Peru between 2014 and 2019. Satellite imagery of the Sentinel sensor from the last five years will be used to measure the vegetation index (NDVI) in each patch. Temporal changes in vegetation index within and between patches will be used as a measure of native vegetation recovery in the region.

An expected result is that the configuration of Bracken fern patches will determine natural regeneration in these degraded areas. So, my first step will be to measure the distance from pixel to the close forest, applying the nearest neighbor analysis. To accomplish this first step, I will use sample data to test the efficiency of different packages in analyzing the distance of pixels located in the Bracken fern patches to the forest.



## PSUEDOCODE!!
Before you get started programming all of the potential things you could do during the course of this demo. Lay out the steps you'll need to get there (see below for what I mean). You don't have to actually code these things (yet) just help us see how you're approaching the problem.
```{r}


#load the libraries - tell us which packages you're using and why
#Packages:
#  sp
#  gdal
  

library(data.table)  
library(sp)
library(maptools)
library(googledrive)
options(
  gargle_oauth_cache = ".secrets",
  gargle_oauth_email = TRUE
)

library(here)
library(raster)
library(rasterVis)
library(rgdal)
library(viridis)
library(scales)
library(maptools)
library(rgeos)
library(dplyr)
library(RColorBrewer)
library(ggplot2)




#vignette(package="spdep")
#vignette(package="here")


#load your data - which datasets do you need?


folder_url <- "https://drive.google.com/drive/folders/1r8XsNTTKWCiWHSxR_ldISpLHzZJbla3o"

folder <- drive_get(as_id(folder_url))
gdrive_files <- drive_ls(folder)
lapply(gdrive_files$id, function(x) drive_download(as_id(x),
                                                   path = paste0(here::here("datatemp/original/"), "/",gdrive_files[gdrive_files$id==x,]$name), overwrite = TRUE))

#getwd()
#paste0(here::here("datatemp/original/"),words)

#getwd()
#wd<-"C:/Users/Sandra/Desktop/R files/Stats/RMarkdownAssignment_Sandra/datatemp/"

## I don't think this helps you and definitelty doesn't work if I try to runit here. Suggest deleting
#path="C:/Users/Sandra/Desktop/R files/Stats/RMarkdownAssignment_Sandra/datatemp/"
#list.files(path)

#originaldata_sample

### After donwloaded the raster image from Google drive, I renamed the originalS06W080.hgt to S06W080.hgt.

##This shouldn't be necessary
#getwd()
#wd<-"C:/Users/Sandra/Desktop/R files/Stats/RMarkdownAssignment_Sandra/datatemp/"


#options(stringsAsFactors=FALSE)
#pixels <- read.csv(paste0(wd,"originaldata_sample.csv"))
pixels <- read.csv(here::here("datatemp/original/data_sample.csv"), stringsAsFactors = FALSE)
str(pixels)

elev=raster::raster(here::here("datatemp/original/S06W080.hgt"))
elev

####This is where I stopped


#Organize the data - what form should the data be in? A list? how many elements, a data frame? how many rows and columns?

originaldata_sample

class(originaldata_sample)
head(originaldata_sample)
names(originaldata_sample)
colnames(originaldata_sample)
dim(originaldata_sample)

#Analysis/processing step 1 - what are you hoping to do here, why? 

###Step1: I use crs function from sp package to project the originaldata_sample.

crs
elev@crs
pixels_spdf <- SpatialPointsDataFrame(
  pixels[,1:2],proj4string=elev@crs, pixels)

#Analysis/processing step 2 - what are you hoping to do here, why? 
##Step2: I use extract funtion to get elevation data from the raster image.

pixel_elev <- raster::extract(elev, # raster layer
    pixels_spdf,   # SPDF with pixels
    df=TRUE)         # return a dataframe
pixel_elev
str(pixel_elev)

### grab the name of the ID_pixel from the pixels_spdf

pixel_elev$pix_id<- pixels_spdf$ID_pixel
pixel_elev$pix_id

#fix the column names
names(pixel_elev) <- c('ID','elev','pix_id')
pixel_elev


# The pixels and pixel_elev data were merged, using merge function from package base.

pixelelev <- merge(pixels, pixel_elev, by.x = 'ID_pixel', by.y = 'pix_id')
getAnywhere(merge)
stats:::.makeNamesTs

head(pixelelev)


#Analysis/processing step 2 - what are you hoping to do here, why? 
##Step3: 






#Check the outcomes? How will you know if your steps worked?

# 
```

## Introduce the packages
Given your psuedo code, where is the critical step? What packages and functions are you considering to help you complete this step? Why did you choose them? 




## Evaluate your choices
Use profiling and benchmarking to evaluate which of your options is likely to be the fastest. How does the syntax and/or ease of use of that function impact your decision of whether or not to use it? (For example, velox is much faster than raster, but it's less well documented and the syntax is strange to get used to).




## Show us your final product
Did you make a map? Let's see it. Did you plot some data that you extracted with raster? show us that plot. Did you have an idea of how the data should look after you were done processing it? Were you successful? What went wrong




## Reflect
Write a few sentences on what you learned from this exercise. How has your skill improved? What do you wish you understood better? What do you imagine your next steps to be?

Once you're done push the "knit" button to create the html page from your Rmarkdown document. If you've got questions, let me know!!
