---
title: "Interactive COVID-19 Chart for Idaho"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(tidyverse)
library(flexdashboard)
library(dygraphs)
library(timetk)
library(here)
library(leaflet)
library(highcharter)

```

# notes from matt

- create maps with two different packages and compare and contrast them
- it's okay to use someone else's code, just need to cite it

Dashboard
=====================================

```{r load data, message=FALSE, warning=FALSE, include=FALSE}
#### Load functions ####

# this is calling up the script for two functions that will come in handy later 
source(here("Flexdashboard", "Script", "Functions", "create_dt.R"))
source(here("Flexdashboard","Script", "Functions", "rgb2hex.R"))

#### Load datasets ####
#these datasets are on github so you can just put the link in to call up the file location on github
df_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv")
df_deaths <- read_csv("https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv")

#### subset data to get just information for Idaho ####
id_df_confirmed <- subset(df_confirmed, Province_State=="Idaho" & FIPS < 17000)
id_df_deaths <- subset(df_deaths, Province_State=="Idaho" & FIPS < 17000)

#rename some of the columns to make it easier to analyze the data
id_df_confirmed <- rename(id_df_confirmed, County = Admin2, Lat = Lat, Long= Long_)
id_df_deaths <- rename(id_df_deaths, County = Admin2, Lat = Lat, Long= Long_)

run_summary <- function(data, varname, today_date = NULL){
    data %>%
      select(-Lat, -Long) %>%
      gather(Date, !!sym(varname))%>%
      mutate_at(vars(Date), ~lubridate::mdy(.)) %>%
      group_by(Date) %>%
      summarise(!!sym(varname) := sum(!!sym(varname), na.rm = TRUE)) 
}

id_df_confirmed %>% run_summary(varname = "Confirms") -> summary_confirmed
id_df_deaths %>% run_summary(varname = "Deaths") -> summary_deaths

#list(summary_confirmed,
    # summary_deaths) %>%
 # reduce(full_join, by = "Date") %>%
 # mutate_at(vars(Date), ~lubridate::mdy(.)) %>%
  #arrange(Date) %>%
 # drop_na() -> output_data
```

Column {data-width=650}
-----------------------------------------------------------------------

**Introduction**

This is an example of *interactive chart* to show the growth of COVID-19 cases in Idaho using a flex dashboard. This example explores the leaflet package 

### Chart A

```{r}

```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
# we are going to use the highcharter package to display information
# let's pull up a map of idaho, at the county level
hcmap("countries/us/us-id-all") %>%
  hc_title(text = "Idaho")

# now we are going to add data to this map


glimpse(id_df_confirmed)

hcmap("countries/us/us-id-all", name = "Idaho") %>% 
  hc_add_series(data = id_df_confirmed, type = "mappoint",
                name = "Confirmed COVID-19 Cases", maxSize = "10",
                tooltip_chart(accesor = NULL, hc_opts = NULL, width = 250,
                height = 150)
                 tooltip = list(pointFormat = "{point.name}: {id_df_confirmed$Admin2 + County}")) %>% 
  hc_chart(zoomType = "panKey")
```

### Chart C

```{r}

```

Background
=====================================

This dashboard was created to help explore two different ways of displaying COVID-19 data. 

The data used to build the analysis is taken from the data repository for the 2019 Novel Coronavirus Visual Dashboard, operated by the Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE). Their GitHub repo is linked [here](https://github.com/CSSEGISandData/COVID-19).

This dashboard was created by Tara Pozzi. 
