---
title: "FarmPrES: Farmland Preservation for Ecosystem Services"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    theme: sandstone
    runtime: shiny
---

```{r setup, include=FALSE}
#needed packages
library(flexdashboard) #neccesary for making dashboard 
library(dplyr) #Useful for data wrangling
library(ggplot2) #In order to make a figure (I think ggplot make the prettiest ones)
library(shiny) #neccesary for an interactive plot
library(googledrive) #needed to download data from google drive 
library(here) #specify location of data 

#Date: 4-27-2020
#Creator: Sarah Halperin 
#Contact: sarahhalperin@u.boisestate.edu
#Notes: Below you will find code to create a flexdashboard, which I have used to give a brief outline of my project on one tab and another tab that is an interactive bar chart. The code provides good examples of how to organize a flexdashboard, write text, import images (which doesn't work awesomely), and create a simple interactive figure. If you have any questions or suggestions please email me at sarahhalperin@u.boisestate.edu. Happy Coding! 


#You may need to set the working directory to your local copy of the respository and create a folder called HES598/Flexdashboard 

#Useful Link to learn how to format a flexdashboard 
#https://rmarkdown.rstudio.com/flexdashboard/
# ==== means a new tab 
# ----- means new section on same tab 
# *"Word"* is for bold words 
#_"Word_ is for italics 

#Set up google drive 
folder_url <- "https://drive.google.com/drive/folders/14FGz2TehM1XwuDPt6hNJk_RoZsrRKcjg" 

folder <- drive_get(as_id(folder_url))
gdrive_files <- drive_ls(folder)
lapply(gdrive_files$id, function(x) drive_download(as_id(x),
                                                   path = paste0(here::here("Flexdashboard/images/"), gdrive_files[gdrive_files$id==x,]$name), overwrite = TRUE)) #This downloads the images needed for the flexdashboard from the google drive folder. It downloads to a folder in the repository called images. You may need to make sure you have this folder on your computer for the code to successfully run. 


```

Project Description 
===================================== 

Column {data-width = 600}
-----------------------------------------------------------------------

### WHAT'S AT STAKE WHEN THE TREASUE VALLEY LOSES FARMLAND TO GROWTH? 

_**The Problem**_
```{r farmland_graphic, echo = FALSE,out.height= "50%", out.width= "50%", out.extra='style="float:right; padding:10px"'} 
knitr::include_graphics("./images/farmland.jpg")

#code to include an image and the location of the image. This was surprisingly tempermental and I am not sure how to get it to work consistently. 
```
America has some of the most productive, versatile, and resilient agricultural lands. However, farmland is being lost at **175 acres every hour**, **1.5 million acres a year**. By 2012, the most productive lands to support food production dropped below 17% of the total land area in the U.S. Given the limited arable land and the need to feed an increasing population, it is imperative to protect farmland. 

Idaho is one of the fastest growing states. It's population increased by 2.1% in 2019, tying for the highest percentage growth state in the U.S. With this increase in population, farmland is under **threat**. 

_**Treasure Valley**_

The Treasure Valley (Boise Metropolitan Area) is located in southerwestern Idaho. This region is experiencing rapid urban development, which is occuring primarily on agricultural areas. However if growth is restricted to high density, we can limit the loss of agricultural land by **30%**. 

### 
**The Treasure Valley will look very different depending on how the area continues to grow.**
```{r growth_graphic, echo = FALSE}
knitr::include_graphics("./images/growth.png")
```


Column {data-width = 400}
-----------------------------------------------------------------------

### OUR TEAM 
Researchers Dr. Jodi Brandt, Dr. Jen Schneider, and PhD student Sarah Halperin at Boise State University are working to develop novel approaches to accurately **measure** and effectively **communicate** the multiple ecosystem services provided by agriculture, so we can make **informed decisions** about when, where, and how to **preserve farmland** 
```{r team_graphic, echo = FALSE, out.height= "5%", out.width= "5%"}
knitr::include_graphics("./images/Team.png")
```


### OUR SOLUTION
_**Project Objectives**_

1. **Identify the most important agricultural lands to protect**, based on the ecosystem services that people have identified as important

2. **Determine the policy mechanisms** that Idaho decision makers can consider for farmland preservation

3. **Create innovative materials** to disseminate information to local stakeholders and the public                                                                                                                                                                                                 
```{r objectives_graphic, echo = FALSE, fig.align='center'}
knitr::include_graphics("./images/projectObjectives.png")
```

Treasure Valley Crops 
===================================== 


Column {.sidebar}
-------------------------------------------- 
```{r BMAcrop_data, echo=FALSE}
BMAcrop<-read.csv("./BMACrop2005_2018.csv")
BMAcrop<-BMAcrop %>%
  filter(value > 0, Crop_0_1>0) 
Categories<-as.character(BMAcrop$Category)

#filter data and create a list of crop types named categories 
```

Number of acres of the crops grown in the Treasure Valley, ID from 2005 to 2018. Data was downloaded from USDA NASS Cropscape.

```{r}
selectInput("county", label="County:", choices = c("Ada", "Canyon"), selected ="Ada")

selectInput("Category", label="CropType:", choices = Categories, selected ="Corn")

# Here I am designing the tabs that a viewer can select and subset the data based on. The end product you will be able to chose a county and the crop you want to seen shown on a bar graph. 
```

Column
---------------------------------------------------------------
### Crops Grown in the Treasure Valley

```{r}
  
selectedData<-reactive(
  BMAcrop %>%
  filter(county == input$county & Category == input$Category)
)
#selected data is reactive based on the chosen inputs above. 


renderPlot({
  ggplot(selectedData(), aes(x=year,y=acres))+
   geom_bar(stat="identity")+
    scale_x_continuous(name= "Year", breaks= c(2005,2007,2009,2011,2013,2015,2017))+
  scale_y_continuous(name =expression('Total Area Harvested (Acres)'))+ 
  theme_bw()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        panel.background = element_blank(), axis.line = element_line(colour = "black"))+
  theme(axis.text=element_text(size=25, colour="black"),
        axis.title.x=element_text(size=25), axis.title.y =element_text(size=25, face="bold"), legend.text=element_text(size=10))
})

#create a plot based on the reactive data. Note needs to be selectedData() not selectedData because the reactive data is a function. 
#The project has been published to this website: https://shalp.shinyapps.io/farmpres/ 
#often it does not load immediately, FYI
```
